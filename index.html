<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vyom - Plan Price Calculator</title>

    <link rel="icon" type="image/x-icon" href="/agridootfavicon.ico" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .calculator {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        max-width: 640px;
        width: 100%;
      }

      h1 {
        text-align: center;
        margin-bottom: 0.75rem;
        color: #2c3e50;
        font-size: 1.25rem;
      }

      .subtitle {
        text-align: center;
        color: #667085;
        font-size: 0.95rem;
        margin-bottom: 1rem;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
      }

      label {
        font-weight: 600;
        display: block;
        margin: 0.5rem 0 0.25rem;
      }

      input,
      select {
        width: 100%;
        padding: 0.6rem;
        border-radius: 0.5rem;
        border: 1px solid #e6e9ee;
        margin-bottom: 0.5rem;
        font-size: 1rem;
        box-sizing: border-box;
      }

      .hint {
        font-size: 0.85rem;
        color: #8b96a8;
        margin-top: -0.25rem;
        margin-bottom: 0.5rem;
      }

      button {
        background: #196320;
        color: white;
        padding: 0.75rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        transition: background 0.2s ease, transform 0.05s ease;
      }

      button:active {
        transform: translateY(1px);
      }

      button[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .results {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.75rem;
      }

      .tile {
        background: linear-gradient(180deg, #ffffff 0%, #f6faf6 100%);
        padding: 0.9rem;
        border-radius: 0.75rem;
        box-shadow: 0 3px 6px rgba(15, 23, 42, 0.04);
        text-align: center;
        border: 1px solid #eef6ed;
      }

      .tile h3 {
        margin: 0;
        color: #34495e;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .tile p {
        margin: 0.5rem 0 0 0;
        font-size: 1rem;
        font-weight: 700;
        color: #196320;
      }

      .meta {
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: #6b7280;
      }

      @media (max-width: 820px) {
        .row {
          grid-template-columns: 1fr;
        }
        .results {
          grid-template-columns: 1fr;
        }
        .calculator {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="calculator">
      <h1>Vyom - Plan Price Calculator</h1>

      <div class="row">
        <div>
          <label for="farmSize">Farm Size (Acres)</label>
          <input
            type="number"
            id="farmSize"
            placeholder="Enter farm size in acres"
            min="0"
            step="0.1"
          />

          <label for="discount">Discount</label>
          <select id="discount">
            <option value="0">No Discount</option>
            <option value="5">5%</option>
            <option value="10">10%</option>
            <option value="15">15%</option>
            <option value="20">20%</option>
            <option value="25">25%</option>
            <option value="30">30%</option>
            <option value="35">35%</option>
            <option value="40">40%</option>
            <option value="45">45%</option>
            <option value="50">50%</option>
          </select>
        </div>

        <div>
          <label for="variant">Plan Type</label>
          <select id="variant">
            <option value="gold">Gold</option>
            <option value="standard">Platinum</option>
          </select>

          <label for="planType">Plan Duration</label>
          <select id="planType">
            <option value="3mon">Quarterly - 3 Months</option>
            <option value="6mon">Half-Yearly - 6 Months</option>
            <option value="12mon">Yearly - 1 Year</option>
          </select>
        </div>
      </div>

      <button id="calcBtn" onclick="calculatePrice()">Calculate</button>

      <div class="results" id="results" style="display: none">
        <div class="tile">
          <h3>Original Price</h3>
          <p id="price">₹0.00</p>
          <div class="meta" id="metaPrice"></div>
        </div>
        <div class="tile">
          <h3>Final Price (After Discount)</h3>
          <p id="finalPrice">₹0.00</p>
          <div class="meta" id="metaFinal"></div>
        </div>
        <div class="tile">
          <h3>Pay Price (Incl. 18% GST)</h3>
          <p id="payPrice">₹0.00</p>
          <div class="meta" id="metaPay"></div>
        </div>
      </div>

      <div class="meta" id="apiInfo" style="margin-top: 0.75rem"></div>
    </div>

    <script>
      function formatCurrency(num, symbol = "₹") {
        if (isNaN(num)) return `${symbol}0.00`;
        return `${symbol}${Number(num).toFixed(2)}`;
      }

      async function calculatePrice() {
        const farmInput = document.getElementById("farmSize");
        let farmSize = parseFloat(farmInput.value);
        const variant = document.getElementById("variant").value; // 'standard' or 'gold'
        const planType = document.getElementById("planType").value;
        const discount =
          parseFloat(document.getElementById("discount").value) || 0;

        if (isNaN(farmSize) || farmSize <= 0) {
          alert("Please enter a valid farm size.");
          return;
        }

        if (farmSize < 1) {
          farmSize = 1;
          farmInput.value = farmSize;
        }

        const apiUrl = `https://apiv2.agridoot.co.in:12443/ad/v2/vyom/plans?farm=${farmSize}`;

        try {
          const response = await fetch(apiUrl, {
            method: "GET",
            headers: {
              "x-api-key": "agridoot_a7c3d1f905be4d67b14fa12e5e8c32bd",
            },
          });

          const data = await response.json();

          if (
            !(
              data &&
              data.response_status &&
              data.farmPlan &&
              data.farmPlan.actual_price
            )
          ) {
            alert("Failed to fetch price details. Please try again.");
            return;
          }

          const farmPlan = data.farmPlan;
          const symbol = (farmPlan.add_info && farmPlan.add_info.symbol) || "₹";

          // Choose price based on variant
          let price;
          if (variant === "gold" && farmPlan.gold_price) {
            price = farmPlan.gold_price[planType];
          } else {
            price = farmPlan.actual_price[planType];
          }

          if (typeof price === "undefined") {
            alert("Selected plan pricing not available from API.");
            return;
          }

          const finalPrice = price * (1 - discount / 100);
          const payPrice = finalPrice * 1.18;

          document.getElementById("price").innerText = formatCurrency(
            price,
            symbol
          );
          document.getElementById("finalPrice").innerText = formatCurrency(
            finalPrice,
            symbol
          );
          document.getElementById("payPrice").innerText = formatCurrency(
            payPrice,
            symbol
          );

          // Meta info: show unit price, charged area, gold unit if available
          const metaPrice = [];
          if (farmPlan.unit_price && farmPlan.unit_price[planType]) {
            metaPrice.push(
              `Unit price: ${formatCurrency(
                farmPlan.unit_price[planType],
                symbol
              )} / ${(farmPlan.add_info && farmPlan.add_info.unit) || "unit"}`
            );
          }
          if (
            farmPlan.add_info &&
            typeof farmPlan.add_info.charged_area !== "undefined"
          ) {
            metaPrice.push(
              `Charged area: ${farmPlan.add_info.charged_area} ${
                farmPlan.add_info.unit || ""
              }`
            );
          }
          if (
            variant === "gold" &&
            farmPlan.gold_unit &&
            farmPlan.gold_unit[planType]
          ) {
            metaPrice.push(
              `Gold unit: ${formatCurrency(
                farmPlan.gold_unit[planType],
                symbol
              )}`
            );
          }

          document.getElementById("metaPrice").innerText =
            metaPrice.join(" • ");
          document.getElementById(
            "metaFinal"
          ).innerText = `Discount applied: ${discount}%`;
          document.getElementById("metaPay").innerText = `GST: 18% included`;

          // Show additional API info
          const infoParts = [];
          if (farmPlan.add_info) {
            if (farmPlan.add_info.currency)
              infoParts.push(
                `Currency: ${farmPlan.add_info.currency.toUpperCase()}`
              );
            if (farmPlan.add_info.extra_area)
              infoParts.push(`Extra area: ${farmPlan.add_info.extra_area}`);
            if (farmPlan.add_info.unit)
              infoParts.push(`Unit: ${farmPlan.add_info.unit}`);
          }
          document.getElementById("apiInfo").innerText = infoParts.join(" • ");

          document.getElementById("results").style.display = "grid";
        } catch (err) {
          console.error(err);
          alert("Error fetching pricing. Check console for details.");
        }
      }

      // validation for button enabling
      (function attachValidation() {
        const farmInput = document.getElementById("farmSize");
        const calcBtn = document.getElementById("calcBtn");

        function validate() {
          const v = parseFloat(farmInput.value);
          if (!isNaN(v) && v > 0) {
            calcBtn.disabled = false;
          } else {
            calcBtn.disabled = true;
          }
        }

        farmInput.addEventListener("input", validate);
        validate();
      })();
    </script>
  </body>
</html>
